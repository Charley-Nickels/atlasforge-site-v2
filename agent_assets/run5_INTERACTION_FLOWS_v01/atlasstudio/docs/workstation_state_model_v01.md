
# AtlasStudio Workstation State & Panel Model v01

This model defines the primary UI states and how the main panels behave in each state. It also outlines the JSON structures used to represent selected files and active modules.

## UI States

1. **Idle**
   - **Description:** No file selected; the user is browsing the file tree or has not interacted yet.
   - **Visible Panels:** Top toolbar, file explorer, chat panel. The editor panel displays a placeholder message.
   - **State Data:**
     ```json
     {
       "state": "Idle",
       "selectedFile": null,
       "activeModule": null
     }
     ```
2. **FileSelected**
   - **Description:** A file has been selected from the file explorer.
   - **Visible Panels:** All panels. The editor panel shows the file preview according to `file_type_views.json`.
   - **State Data:**
     ```json
     {
       "state": "FileSelected",
       "selectedFile": "/projects/creative_labs.proj",
       "activeModule": null
     }
     ```
   - **Notes:** If the selected file is a `.proj`, the editor panel switches to Project Overview mode.
3. **AtlasVResponding**
   - **Description:** An Atlas‑V action has been invoked and is processing.
   - **Visible Panels:** All panels remain visible. The chat panel shows a “typing…” indicator; the editor may display a loading state if an action affects it (e.g., `Patch now`).
   - **State Data:**
     ```json
     {
       "state": "AtlasVResponding",
       "selectedFile": "/modules/network_manager.atlas",
       "activeModule": "network_manager",
       "pendingAction": "Patch now"
     }
     ```
4. **DiffView**
   - **Description:** Displaying a patch diff generated by Atlas‑V.
   - **Visible Panels:** All panels; however, the editor panel switches to a two‑pane diff viewer. A banner at the top offers options to accept or discard the changes.
   - **State Data:**
     ```json
     {
       "state": "DiffView",
       "selectedFile": "/modules/network_manager.atlas",
       "activeModule": "network_manager",
       "diffContent": "[patch text]"
     }
     ```

## Panel Visibility Matrix

| State            | Toolbar | File Tree | Editor Panel | Chat Panel |
|------------------|---------|-----------|--------------|-----------|
| **Idle**         | Show    | Show      | Placeholder  | Show      |
| **FileSelected** | Show    | Show      | Show         | Show      |
| **AtlasVResponding** | Show | Show      | Show/Loading | Show (typing) |
| **DiffView**     | Show    | Show      | Diff View    | Show      |

## Data Structures

### Selected File / Active Module

```json
{
  "selectedFile": "/modules/audio_processor.json",
  "activeModule": "audio_processor",
  "selectedFileType": "json"
}
```

- `selectedFile`: Absolute path of the file selected in the tree.
- `activeModule`: Only populated when a module file (`.atlas`) is selected; corresponds to the module’s identifier.
- `selectedFileType`: Derived from the file extension; used to look up the view mode in `file_type_views.json`.

### Atlas‑V Pending Action

When an action is triggered, the state stores additional fields:

```json
{
  "pendingAction": "Generate ideas",
  "actionContext": {
    "targetFile": "/projects/creative_labs.proj",
    "additionalParams": {}
  }
}
```

This allows the frontend to display progress indicators and route responses to the correct panel.

